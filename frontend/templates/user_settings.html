{% extends "base.html" %}

{% block title %}Account Settings{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Account Settings</h1>

    <div class="row">
        <!-- Settings Navigation -->
        <div class="col-md-3">
            <div class="list-group">
                <a href="#profile" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                    <i class="fas fa-user me-2"></i>Profile
                </a>
                <a href="#security" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-shield-alt me-2"></i>Security
                </a>
                <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-bell me-2"></i>Notifications
                </a>
                <a href="#privacy" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-lock me-2"></i>Privacy
                </a>
                <a href="#preferences" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-cog me-2"></i>Preferences
                </a>
            </div>
        </div>

        <!-- Settings Content -->
        <div class="col-md-9">
            <div class="tab-content">
                <!-- Profile Settings -->
                <div class="tab-pane fade show active" id="profile">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Profile Information</h5>
                            <form id="profileForm">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="firstName" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="first_name" 
                                               value="{{ settings.first_name }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="lastName" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="last_name" 
                                               value="{{ settings.last_name }}" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" 
                                           value="{{ settings.email }}" required>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" name="phone_number" 
                                               value="{{ settings.phone_number }}">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="gender" class="form-label">Gender</label>
                                        <select class="form-select" id="gender" name="gender">
                                            <option value="">Select Gender</option>
                                            <option value="male" {% if settings.gender == 'male' %}selected{% endif %}>Male</option>
                                            <option value="female" {% if settings.gender == 'female' %}selected{% endif %}>Female</option>
                                            <option value="other" {% if settings.gender == 'other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="birthdate" class="form-label">Birth Date</label>
                                    <input type="date" class="form-control" id="birthdate" name="birthdate" 
                                           value="{{ settings.birthdate }}">
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" id="address" name="address" rows="3">{{ settings.address }}</textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="profilePicture" class="form-label">Profile Picture</label>
                                    <input type="file" class="form-control" id="profilePicture" name="profile_picture" accept="image/*">
                                </div>

                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="tab-pane fade" id="security">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Security Settings</h5>
                            <form id="securityForm">
                                <div class="mb-3">
                                    <label for="currentPassword" class="form-label">Current Password</label>
                                    <input type="password" class="form-control" id="currentPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Update Password</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="tab-pane fade" id="notifications">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Notification Preferences</h5>
                            <form id="notificationForm">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="emailNotifications" 
                                               {% if settings.notification_preferences.email %}checked{% endif %}>
                                        <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="orderUpdates" 
                                               {% if settings.notification_preferences.order_updates %}checked{% endif %}>
                                        <label class="form-check-label" for="orderUpdates">Order Updates</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="promotionalEmails" 
                                               {% if settings.notification_preferences.promotional %}checked{% endif %}>
                                        <label class="form-check-label" for="promotionalEmails">Promotional Emails</label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Preferences</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="tab-pane fade" id="privacy">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Privacy Settings</h5>
                            <form id="privacyForm">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="profileVisibility" 
                                               {% if settings.privacy_settings.profile_visible %}checked{% endif %}>
                                        <label class="form-check-label" for="profileVisibility">Public Profile</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showEmail" 
                                               {% if settings.privacy_settings.show_email %}checked{% endif %}>
                                        <label class="form-check-label" for="showEmail">Show Email Address</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showOrders" 
                                               {% if settings.privacy_settings.show_orders %}checked{% endif %}>
                                        <label class="form-check-label" for="showOrders">Show Order History</label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Preferences -->
                <div class="tab-pane fade" id="preferences">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Preferences</h5>
                            <form id="preferencesForm">
                                <div class="mb-3">
                                    <label for="language" class="form-label">Language</label>
                                    <select class="form-select" id="language" name="language_preference">
                                        <option value="en" {% if settings.language_preference == 'en' %}selected{% endif %}>English</option>
                                        <option value="tr" {% if settings.language_preference == 'tr' %}selected{% endif %}>Turkish</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="currency" class="form-label">Currency</label>
                                    <select class="form-select" id="currency" name="currency_preference">
                                        <option value="USD" {% if settings.currency_preference == 'USD' %}selected{% endif %}>USD ($)</option>
                                        <option value="EUR" {% if settings.currency_preference == 'EUR' %}selected{% endif %}>EUR (€)</option>
                                        <option value="TRY" {% if settings.currency_preference == 'TRY' %}selected{% endif %}>TRY (₺)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="timezone" class="form-label">Timezone</label>
                                    <select class="form-select" id="timezone" name="timezone">
                                        <option value="UTC" {% if settings.timezone == 'UTC' %}selected{% endif %}>UTC</option>
                                        <option value="Europe/Istanbul" {% if settings.timezone == 'Europe/Istanbul' %}selected{% endif %}>Istanbul (UTC+3)</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Preferences</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle form submissions
    const forms = ['profileForm', 'securityForm', 'notificationForm', 'privacyForm', 'preferencesForm'];
    
    forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(form);
                const data = {};
                formData.forEach((value, key) => data[key] = value);
                
                try {
                    const response = await fetch('/my-profile/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Settings updated successfully!');
                    } else {
                        alert('Error: ' + result.message);
                    }
                } catch (error) {
                    alert('Error updating settings: ' + error.message);
                }
            });
        }
    });
});
</script>
{% endblock %}

{% endblock %} 