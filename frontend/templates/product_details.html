{% extends "base.html" %}

{% block title %}{{ product.name }} - HACOM{% endblock %}

{% block additional_styles %}
.product-container {
    display: flex;
    gap: 40px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.product-image {
    flex: 0 0 50%;
    max-width: 500px;
}

.product-image img {
    width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.product-info {
    flex: 1;
}

.product-title {
    font-size: 2em;
    color: #162938;
    margin-bottom: 10px;
}

.product-brand {
    color: #666;
    font-size: 1.2em;
    margin-bottom: 20px;
}

.product-price {
    font-size: 2em;
    color: #00C4FF;
    margin: 20px 0;
}

.product-rating {
    color: #ffa41c;
    margin: 10px 0;
}

.stock-info {
    color: #4CAF50;
    margin: 10px 0;
}

.product-category {
    display: inline-block;
    background: #f0f0f0;
    padding: 5px 15px;
    border-radius: 15px;
    color: #666;
}

.action-buttons {
    display: flex;
    gap: 20px;
    margin-top: 30px;
}

.add-to-cart, .add-to-wishlist {
    padding: 12px 25px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.1em;
    transition: background 0.3s;
}

.add-to-cart {
    background: #162938;
    color: white;
}

.add-to-cart:hover {
    background: #2a3f54;
}

.add-to-wishlist {
    background: #f0f0f0;
    color: #162938;
}

.add-to-wishlist:hover {
    background: #e0e0e0;
}

.heart-button {
    background: none;
    border: none;
    font-size: 24px;
    color: #ccc;
    cursor: pointer;
    transition: color 0.3s;
    padding: 10px;
}

.heart-button.active {
    color: #ff4444;
}

.merchant-info {
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.merchant-info h3 {
    color: #162938;
    margin-bottom: 10px;
}

.merchant-link {
    color: #00C4FF;
    text-decoration: none;
    font-weight: 500;
}

.merchant-link:hover {
    text-decoration: underline;
}

.reviews-section {
    margin-top: 40px;
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.review-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
}

.review-item:last-child {
    border-bottom: none;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.review-rating {
    color: #ffa41c;
}

.show-all-reviews {
    display: block;
    text-align: center;
    padding: 10px;
    margin-top: 20px;
    background: #f8f9fa;
    color: #162938;
    text-decoration: none;
    border-radius: 5px;
    transition: background 0.3s;
}

.show-all-reviews:hover {
    background: #e9ecef;
}

.similar-products {
    margin-top: 40px;
    position: relative;
}

.products-slider {
    display: flex;
    overflow-x: hidden;
    scroll-behavior: smooth;
    padding: 20px 0;
}

.product-slide {
    flex: 0 0 250px;
    margin-right: 20px;
}

.slider-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(22, 41, 56, 0.8);
    color: white;
    border: none;
    padding: 15px;
    cursor: pointer;
    border-radius: 50%;
    z-index: 2;
}

.slider-arrow.left {
    left: -20px;
}

.slider-arrow.right {
    right: -20px;
}

.slider-arrow:hover {
    background: rgba(22, 41, 56, 1);
}
{% endblock %}

{% block content %}
<div class="product-container">
    <div class="product-image">
        <img src="{{ product.image_url }}" alt="{{ product.name }}">
    </div>
    <div class="product-info">
        <h1 class="product-title">{{ product.name }}</h1>
        <p class="product-brand">{{ product.brand }}</p>
        <p class="product-price">${{ "%.2f"|format(product.price) }}</p>
        {% if product.rating %}
        <p class="product-rating">Rating: {{ "%.1f"|format(product.rating) }}/5</p>
        {% endif %}
        <p class="stock-info">In Stock ({{ product.stock_quantity }} available)</p>
        <p class="product-category">{{ product.category }}</p>
        
        <div class="merchant-info">
            <h3>{{ product.merchant_id }}</h3>
            <button 
                class="merchant-button" 
                onclick="window.location.href='/merchant/{{ product.merchant_id }}';">
                {{ product.merchant_id }}
            </button>
        </div>
        
        <div class="action-buttons">
            <button class="add-to-cart" onclick="addToCart('{{ product.id }}', 1)">Add to Cart</button>
            <button class="heart-button {% if in_wishlist %}active{% endif %}" 
                    onclick="toggleWishlist('{{ product.id }}')" 
                    id="wishlist-button">
                <i class="fas fa-heart"></i>
            </button>
        </div>
    </div>
</div>

<!-- Reviews Section -->
<div class="reviews-section">
    <h2>Customer Reviews</h2>
    {% if product.reviews %}
        <div class="reviews-list">
            {% for review in product.reviews[:5] %}
                <div class="review-item">
                    <div class="review-header">
                        <strong>{{ review.username }}</strong>
                        <span class="review-rating">
                            {% for i in range(5) %}
                                <i class="fas fa-star {% if i < review.rating %}filled{% endif %}"></i>
                            {% endfor %}
                        </span>
                    </div>
                    <p>{{ review.comment }}</p>
                    <small>{{ review.date }}</small>
                </div>
            {% endfor %}
        </div>
        {% if product.reviews|length > 5 %}
            <a href="/product/{{ product.id }}/reviews" class="show-all-reviews">
                Show All Reviews ({{ product.reviews|length }})
            </a>
        {% endif %}
    {% else %}
        <p>No reviews available for this product.</p>
    {% endif %}
</div>

<!-- Similar Products Section -->
<div class="similar-products">
    <h2>Similar Products</h2>
    {% if similar_products %}
        {% if similar_products|length > 4 %}
            <button class="slider-arrow left" onclick="slideProducts('left', 'similarSlider')" id="similarLeftArrow" style="display: none;">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="slider-arrow right" onclick="slideProducts('right', 'similarSlider')" id="similarRightArrow">
                <i class="fas fa-chevron-right"></i>
            </button>
        {% endif %}
        <div class="products-slider" id="similarSlider">
            {% for similar_product in similar_products %}
                <div class="product-slide">
                    <div class="product-image">
                        <img src="{{ similar_product.image_url }}" alt="{{ similar_product.name }}" onerror="this.src='/static/images/default-product.jpg'">
                    </div>
                    <div class="product-info">
                        <h3>{{ similar_product.name }}</h3>
                        <p class="product-price">${{ "%.2f"|format(similar_product.price) }}</p>
                        <button onclick="window.location.href='/product/{{ similar_product.id }}'">
                            View Details
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No similar products found</p>
    {% endif %}
</div>

<!-- Category Products Section -->
<div class="similar-products category-products">
    <h2>More from {{ product.category }}</h2>
    {% if category_products %}
        {% if category_products|length > 4 %}
            <button class="slider-arrow left" onclick="slideProducts('left', 'categorySlider')" id="categoryLeftArrow" style="display: none;">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="slider-arrow right" onclick="slideProducts('right', 'categorySlider')" id="categoryRightArrow">
                <i class="fas fa-chevron-right"></i>
            </button>
        {% endif %}
        <div class="products-slider" id="categorySlider">
            {% for category_product in category_products %}
                <div class="product-slide">
                    <div class="product-image">
                        <img src="{{ category_product.image_url }}" alt="{{ category_product.name }}" onerror="this.src='/static/images/default-product.jpg'">
                    </div>
                    <div class="product-info">
                        <h3>{{ category_product.name }}</h3>
                        <p class="product-price">${{ "%.2f"|format(category_product.price) }}</p>
                        <button onclick="window.location.href='/product/{{ category_product.id }}'">
                            View Details
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No additional products found in this category</p>
    {% endif %}
</div>

<script>
function toggleWishlist(productId) {
    const button = document.getElementById('wishlist-button');
    const isActive = button.classList.contains('active');
    
    const url = isActive ? `/wishlist/remove/${productId}` : `/wishlist/add/${productId}`;
    
    fetch(url, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            button.classList.toggle('active');
        } else {
            alert('Failed to update wishlist: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function updateArrows(sliderId) {
    const slider = document.getElementById(sliderId);
    const leftArrow = document.getElementById(sliderId.replace('Slider', 'LeftArrow'));
    const rightArrow = document.getElementById(sliderId.replace('Slider', 'RightArrow'));
    
    if (leftArrow) {
        leftArrow.style.display = slider.scrollLeft > 0 ? 'block' : 'none';
    }
    
    if (rightArrow) {
        const remainingScroll = slider.scrollWidth - (slider.scrollLeft + slider.clientWidth);
        rightArrow.style.display = remainingScroll > 0 ? 'block' : 'none';
    }
}

function slideProducts(direction, sliderId) {
    const slider = document.getElementById(sliderId);
    const slideAmount = 270; // Width of slide + margin
    
    if (direction === 'left') {
        slider.scrollLeft -= slideAmount;
    } else {
        slider.scrollLeft += slideAmount;
    }
    
    // Update arrows after scrolling
    setTimeout(() => updateArrows(sliderId), 100);
}

// Initialize arrows on load
document.addEventListener('DOMContentLoaded', function() {
    updateArrows('similarSlider');
    updateArrows('categorySlider');
});

function addToCart(productId, quantity) {
    fetch(`/cart/add/${productId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ quantity: quantity })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Product added to cart successfully!');
        } else {
            alert('Failed to add product to cart: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>
{% endblock %} 